#!/bin/sh

set -euo pipefail
set -x

try_broser() {
  if test -x "$1"; then
    export BROWSER="$1"
    return 0
  fi
  return 1
}

set +e

if test -n "${GOOGLE_BROWSER:-}"; then
  if ! test -x "$GOOGLE_BROWSER"; then
    echo "error: file in GOOGLE_BROWSER variable is not executable" >&2
    exit 1
  fi
  BROWSER="$GOOGLE_BROWSER"
else
  for b in \
      '/usr/bin/firefox' \
      'C:/Program Files (x86)\Mozilla Firefox\firefox.exe' \
      'C:/Program Files\Mozilla Firefox\firefox.exe' \
      '/usr/bin/google-chrome' \
      'C:/Program Files (x86)/Google/Chrome/Application/chrome.exe' \
      'C:/Program Files/Google/Chrome/Application/chrome.exe'; do
    if test -x "$b"; then
      BROWSER="$b"
      break
    fi
  done
fi

if test $# -gt 0; then
  "$BROWSER" "http://google.com/search?q=$@"
else
  read line  # cat?
  "$BROWSER" "http://google.com/search?q=$line"
fi
